# 云存储服务使用指南（七牛云）

本指南将详细介绍如何使用七牛云存储服务来存储和管理报账文件，适合没有云服务使用经验的用户操作。

## 一、注册七牛云账号

1. **访问七牛云官网**：
   - 打开浏览器，访问 [七牛云官网](https://www.qiniu.com/)
   - 点击右上角的"注册"按钮

2. **填写注册信息**：
   - 输入手机号
   - 点击"获取验证码"
   - 输入收到的验证码
   - 设置登录密码
   - 点击"注册"按钮

3. **完成实名认证**：
   - 注册成功后，系统会提示你完成实名认证
   - 点击"立即认证"按钮
   - 选择"个人认证"
   - 填写真实姓名和身份证号
   - 上传身份证正反面照片
   - 点击"提交认证"按钮
   - 等待认证通过（通常1-2个工作日）

## 二、创建存储桶

1. **登录七牛云控制台**：
   - 访问 [七牛云控制台](https://console.qiniu.com/)
   - 输入手机号和密码，点击"登录"按钮

2. **进入对象存储**：
   - 在左侧导航栏中，点击"对象存储"
   - 点击"空间管理"（空间就是存储桶）

3. **创建存储桶**：
   - 点击"创建空间"按钮
   - 填写存储桶名称（例如：`reimbursement-system`）
   - 选择存储区域（建议选择"华东"区域）
   - 访问控制选择"公开"（方便文件下载）
   - 点击"确定"按钮

4. **获取存储桶域名**：
   - 存储桶创建成功后，点击存储桶名称进入详情页
   - 在"域名管理"部分，找到"默认域名"（例如：`reimbursement-system.qiniu.com`）
   - 记录下这个域名，后续会用到

## 三、获取API密钥

1. **进入密钥管理**：
   - 在左侧导航栏中，点击"个人中心"
   - 点击"密钥管理"

2. **查看API密钥**：
   - 在"密钥管理"页面，你可以看到"AccessKey"和"SecretKey"
   - 点击"显示"按钮，输入登录密码后可以看到完整的密钥
   - 记录下这两个密钥，后续会用到

## 四、配置项目中的云存储

1. **安装七牛云SDK**：
   - 在项目文件夹中打开命令提示符
   - 输入：`npm install qiniu --save`，按回车
   - 等待安装完成

2. **修改后端代码**：
   - 打开 `api/index.js` 文件
   - 找到 `uploadToCloudStorage` 函数
   - 取消注释七牛云配置代码
   - 填写真实的配置信息：
     ```javascript
     const qiniu = require('qiniu');
     const accessKey = '你的七牛云AccessKey';
     const secretKey = '你的七牛云SecretKey';
     const bucket = '你的七牛云存储桶名称';
     ```
   - 修改云存储域名：
     ```javascript
     url: `https://你的七牛云域名/${fileName}`
     ```

3. **重启后端服务**：
   - 在命令提示符中输入：`pm2 restart reimbursement-system`，按回车
   - 等待服务重启完成

## 五、测试云存储功能

1. **上传文件**：
   - 打开前端页面
   - 登录系统
   - 选择一个模块，上传文件
   - 点击"确定（分组）"按钮

2. **查看文件上传状态**：
   - 打开浏览器的开发者工具（按F12）
   - 选择"Console"（控制台）
   - 查看上传日志，应该显示"后端上传成功"

3. **测试文件下载**：
   - 点击文件旁边的"下载"按钮
   - 检查文件是否能正常下载

4. **查看我的文件**：
   - 点击"查看我的文件"按钮
   - 检查是否能看到自己上传的文件列表

## 六、常见问题及解决方案

### 1. 上传失败
- **问题**：文件上传失败，控制台显示错误信息
- **解决方案**：
  - 检查七牛云配置是否正确
  - 检查AccessKey和SecretKey是否正确
  - 检查存储桶名称是否正确
  - 检查网络连接是否正常

### 2. 下载失败
- **问题**：文件无法下载
- **解决方案**：
  - 检查存储桶的访问控制是否设置为"公开"
  - 检查七牛云域名是否正确
  - 检查文件是否成功上传到云存储

### 3. 查看文件列表失败
- **问题**：无法查看自己上传的文件列表
- **解决方案**：
  - 检查浏览器的本地存储是否正常
  - 检查前端代码是否正确
  - 检查文件组是否成功保存到本地存储

## 七、注意事项

1. **免费额度**：
   - 七牛云新用户有10GB免费存储空间和10GB免费流量
   - 超出免费额度后会产生费用，请合理使用

2. **安全考虑**：
   - 不要在代码中硬编码AccessKey和SecretKey，建议使用环境变量
   - 定期更新密码和密钥
   - 不要上传敏感文件到公开存储桶

3. **其他云存储选项**：
   - 如果你不想使用七牛云，也可以选择其他云存储服务：
     - 阿里云OSS
     - 腾讯云COS
     - 华为云OBS
     - Amazon S3

## 八、联系我们

如果在使用过程中遇到任何问题，随时联系我们，我们会为你提供进一步的帮助！